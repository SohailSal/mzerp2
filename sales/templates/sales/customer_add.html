{% extends "base/base.html" %}
{% block title %} Insert Customer {% endblock %}
{% block content %}

<h3>Insert Customer</h3>
<div x-data="handler()" x-cloak>
  <form class="row g-3" id="customerForm" @submit.prevent="submit">
      <template x-if="errors">
          <div class="alert alert-danger">
          <template x-for="(error, index) in errors">
              <p>
              <strong><span x-text="index"></strong></span>: <span x-text="error"></span>
              </p>
          </template>
          <button @click="hideMsg" class="alert alert-secondary">X</button>
          </div>
      </template>
      <template x-if="messages">
          <div class="alert alert-success">
          <template x-for="(message, index) in messages">
              <p>
              <strong><span x-text="index"></strong></span>: <span x-text="message"></span>
              </p>
          </template>
          <button @click="hideMsg" class="alert alert-secondary">X</button>
          </div>
      </template>
      <div class="col-md-6">
        <label for="ref" class="form-label">Ref</label>
        <input type="text" x-model="ref" class="form-control" id="ref">
      </div>
      <div class="col-md-6">
        <label for="date" class="form-label">Date</label>
        <input type="date" x-model="date" class="form-control" id="date">
      </div>
      <div class="col-12">
        <label for="description" class="form-label">Description</label>
        <input type="text" x-model="description" class="form-control" id="description" placeholder="To record...">
      </div>
    </form>
  </div>

<script>
  function handler() {
  return {
      messages: '',
      errors: '',
      ref: '',
      date: '',
      description: '',
      formLoading: false,
      submitText: 'Insert Transaction',

      submit(event) {
          event.preventDefault();
          this.formLoading = true;
          this.submitText = 'Submitting...';
          const endpointUrl = "transaction_post"
          fetch(endpointUrl, {
              method: "post",
              body: JSON.stringify({
                  entries: this.entries,
                  ref: this.ref,
                  date: this.date,
                  description: this.description,
              }),
              headers: {
                  'X-CSRFToken': '{{ csrf_token }}',
              },
          })
          .then(response => {
              return response.json();
          })
          .then(data => {
              this.errors = data.errors
              this.messages = data.messages
          })
          .finally(()=>{
              this.formLoading = false;
              this.submitText = 'Insert Transaction';
          });
      },
      hideMsg(){
          this.errors = ''
          this.messages = ''
      }
    }
  }
</script>
<style>
  [x-cloak] {display: none !important;  }
</style>
{% endblock %}